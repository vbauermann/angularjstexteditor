var angularjstexteditorVersion="v2.0.0",_browserDetect={ie:function(){for(var e=3,t=document.createElement("div"),r=t.getElementsByTagName("i");t.innerHTML="\x3c!--[if gt IE "+ ++e+"]><i></i><![endif]--\x3e",r[0];);return 4<e?e:void 0}(),webkit:/AppleWebKit\/([\d.]+)/i.test(navigator.userAgent),isFirefox:-1<navigator.userAgent.toLowerCase().indexOf("firefox")},performance=performance||{};function stripHtmlToText(e){var t=document.createElement("DIV");t.innerHTML=e;t=t.textContent||t.innerText||"";return t.replace("â€‹",""),t=t.trim()}function getDomFromHtml(e){var t=document.createElement("DIV");return t.innerHTML=e,t}performance.now=performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow||function(){return(new Date).getTime()};var sheet,addCSSRule,removeCSSRule,_addCSSRule,_removeCSSRule,_getRuleIndex,BLOCKELEMENTS=/^(address|article|aside|audio|blockquote|canvas|center|dd|div|dl|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|noscript|ol|output|p|pre|section|table|tfoot|ul|video)$/i,LISTELEMENTS=/^(ul|li|ol)$/i,VALIDELEMENTS=/^(#text|span|address|article|aside|audio|blockquote|canvas|center|dd|div|dl|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|noscript|ol|output|p|pre|section|table|tfoot|ul|video|li)$/i;if(String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),8<_browserDetect.ie||void 0===_browserDetect.ie){for(var _sheets=document.styleSheets,i=0;i<_sheets.length;i++)if((0===_sheets[i].media.length||_sheets[i].media.mediaText.match(/(all|screen)/gi))&&_sheets[i].href&&_sheets[i].href.match(/angularjstexteditor\.(min\.|)css/gi)){sheet=_sheets[i];break}sheet=sheet||function(){var e=document.createElement("style");return _browserDetect.webkit&&e.appendChild(document.createTextNode("")),document.getElementsByTagName("head")[0].appendChild(e),e.sheet}(),addCSSRule=function(e,t){return _addCSSRule(sheet,e,t)},_addCSSRule=function(e,t,r){var n,o;return e.cssRules?n=Math.max(e.cssRules.length-1,0):e.rules&&(n=Math.max(e.rules.length-1,0)),e.insertRule?e.insertRule(t+"{"+r+"}",n):e.addRule(t,r,n),sheet.rules?o=sheet.rules[n]:sheet.cssRules&&(o=sheet.cssRules[n]),o},_getRuleIndex=function(e,t){for(var r,n=0;n<t.length;n++)if(t[n].cssText===e.cssText){r=n;break}return r},removeCSSRule=function(e){_removeCSSRule(sheet,e)},_removeCSSRule=function(e,t){var r=e.cssRules||e.rules;r&&0!==r.length&&(r=_getRuleIndex(t,r),e.removeRule?e.removeRule(r):e.deleteRule(r))}}
angular.module("angularjstexteditor.factories",[]).factory("taBrowserTag",[function(){return function(e){return e?""===e?void 0===_browserDetect.ie?"div":_browserDetect.ie<=8?"P":"p":_browserDetect.ie<=8?e.toUpperCase():e:_browserDetect.ie<=8?"P":"p"}}]).factory("taApplyCustomRenderers",["taCustomRenderers","taDOM",function(t,n){return function(e){var r=angular.element("<div></div>");return r[0].innerHTML=e,angular.forEach(t,function(t){var e=[];t.selector&&""!==t.selector?e=r.find(t.selector):t.customAttribute&&""!==t.customAttribute&&(e=n.getByAttribute(r,t.customAttribute)),angular.forEach(e,function(e){e=angular.element(e),t.selector&&""!==t.selector&&t.customAttribute&&""!==t.customAttribute&&void 0===e.attr(t.customAttribute)||t.renderLogic(e)})}),r[0].innerHTML}}]).factory("taFixChrome",function(){return function(e,t){if(!e||!angular.isString(e)||e.length<=0)return e;for(var r,n,i,a=/style\s?=\s?(["'])(?:(?=(\\?))\2.)*?\1/gi,o=/<span class="Apple-converted-space">([^<]+)<\/span>/gi,s="",l=0;r=o.exec(e);)i=(i=r[1]).replace(/&nbsp;/gi," "),s+=e.substring(l,r.index)+i,l=r.index+r[0].length;if(l&&(e=s+=e.substring(l),s="",l=0),!t){for(;r=a.exec(e);)s+=e.substring(l,r.index-1),n=r[0],(!(r=/font-family: inherit;|line-height: 1.[0-9]{3,12};|color: inherit; line-height: 1.1;|color: rgb\(\d{1,3}, \d{1,3}, \d{1,3}\);|background-color: rgb\(\d{1,3}, \d{1,3}, \d{1,3}\);/gi.exec(n))||8<(n=n.replace(/( |)font-family: inherit;|( |)line-height: 1.[0-9]{3,12};|( |)color: inherit;|( |)color: rgb\(\d{1,3}, \d{1,3}, \d{1,3}\);|( |)background-color: rgb\(\d{1,3}, \d{1,3}, \d{1,3}\);/gi,"")).length)&&(s+=" "+n),l=a.lastIndex;s+=e.substring(l)}return 0<l?s.replace(/<span\s?>(.*?)<\/span>(<br(\/|)>|)/gi,"$1"):e}}).factory("taSanitize",["$sanitize",function(g){for(var f=[{property:"font-weight",values:["bold"],tag:"b"},{property:"font-style",values:["italic"],tag:"i"}],e=[],t=0;t<f.length;t++){for(var r="("+f[t].property+":\\s*(",n=0;n<f[t].values.length;n++)0<n&&(r+="|"),r+=f[t].values[n];r+=");)",e.push(r)}var p="("+e.join("|")+")";function h(e,t){for(var r,n=0,i=0,a=/<[^>]*>/gi;r=a.exec(e);)if(i=r.index,"/"===r[0].substr(1,1)){if(0===n)break;n--}else n++;return t+e.substring(0,i)+angular.element(t)[0].outerHTML.substring(t.length)+e.substring(i)}var u=new RegExp(/<span id="selectionBoundary_\d+_\d+" class="rangySelectionBoundary">[^<>]+?<\/span>/gi),d=new RegExp(/<span class="rangySelectionBoundary" id="selectionBoundary_\d+_\d+">[^<>]+?<\/span>/gi),b=new RegExp(/<span id="selectionBoundary_\d+_\d+" class="rangySelectionBoundary">[^<>]+?<\/span>/gi);return function(e,t,r){if(!r)try{e=function e(t){if(!t||!angular.isString(t)||t.length<=0)return t;for(var r,n,i,a=/<([^>\/]+?)style=("([^"]+)"|'([^']+)')([^>]*)>/gi,o="",s="",l=0;n=a.exec(t);){var c=n[3]||n[4],g=new RegExp(p,"i");if(angular.isString(c)&&g.test(c)){for(var u="",d=new RegExp(p,"ig");i=d.exec(c);)for(r=0;r<f.length;r++)i[2*r+2]&&(u+="<"+f[r].tag+">");g=e(t.substring(l,n.index)),0<o.length?s+=h(g,o):s+=g,c=c.replace(new RegExp(p,"ig"),""),s+="<"+n[1].trim(),0<c.length&&(s+=' style="'+c+'"'),s+=n[5]+">",l=n.index+n[0].length,o=u}}return 0<o.length?s+=h(t.substring(l),o):s+=t.substring(l),s}(e)}catch(e){}if(e=function(e){if(!e||!angular.isString(e)||e.length<=0)return e;for(var t,r=/<([^>\/]+?)align=("([^"]+)"|'([^']+)')([^>]*)>/gi,n="",i=0;t=r.exec(e);){n+=e.substring(i,t.index);var i=t.index+t[0].length,a="<"+t[1]+t[5];/style=("([^"]+)"|'([^']+)')/gi.test(a)?a=a.replace(/style=("([^"]+)"|'([^']+)')/i,'style="$2$3 text-align:'+(t[3]||t[4])+';"'):a+=' style="text-align:'+(t[3]||t[4])+';"',n+=a+=">"}return n+e.substring(i)}(e))try{e=(e=(e=(e=e.replace(u,"")).replace(d,"")).replace(u,"")).replace(b,"")}catch(e){}try{c=g(e),r&&(c=e)}catch(e){c=t||""}for(var n,i=c.match(/(<pre[^>]*>.*?<\/pre[^>]*>)/gi),a=c.replace(/(&#(9|10);)*/gi,""),o=/<pre[^>]*>.*?<\/pre[^>]*>/gi,s=0,l=0,c="";null!==(n=o.exec(a))&&s<i.length;)c+=a.substring(l,n.index)+i[s],l=n.index+n[0].length,s++;return c+a.substring(l)}}]).factory("taToolExecuteAction",["$q","$log",function(a,o){return function(e){void 0!==e&&(this.$editor=function(){return e});var t,r=a.defer(),n=r.promise,i=this.$editor();try{if(this&&!this.action)return;t=this.action(r,i.startAction()),n.finally(function(){i.endAction.call(i)})}catch(e){o.error(e)}!t&&void 0!==t||r.resolve()}}]);
angular.module("angularjstexteditor.DOM",["angularjstexteditor.factories"]).factory("taExecCommand",["taSelection","taBrowserTag","$document","$rangy",function(H,w,b,y){function O(e,t){y.rangy;for(var n,r=e.find("li"),a=r.length-1;0<=a;a--)n=angular.element("<"+t+">"+r[a].innerHTML+"</"+t+">"),e.after(n);e.remove(),H.setSelectionToElementEnd(n[0])}function A(e,t,n,r,a){for(var o,l,i,s=e.find("li"),d=0;d<s.length;d++)if(s[d].outerHTML===t[0].outerHTML){0<(i=d)&&(o=s[d-1]),d+1<s.length&&(l=s[d+1]);break}var f="";if(r?f+="<"+a+">"+t[0].innerHTML+"</"+a+">":(f+="<"+w(n)+">",f+="<li>"+t[0].innerHTML+"</li>",f+="</"+w(n)+">"),n=angular.element(f),o)if(l){e.parent();var c="",f=e[0].nodeName.toLowerCase();for(c+="<"+f+">",d=0;d<i;d++)c+="<li>"+s[d].innerHTML+"</li>";c+="</"+f+">";var g="";for(g+="<"+f+">",d=i+1;d<s.length;d++)g+="<li>"+s[d].innerHTML+"</li>";g+="</"+f+">",e.after(angular.element(g)),e.after(n),e.after(angular.element(c)),e.remove(),H.setSelectionToElementEnd(n[0])}else t.remove(),e.after(n),H.setSelectionToElementEnd(n[0]);else t.remove(),e.after(angular.element(e[0].outerHTML)),e.after(n),e.remove(),H.setSelectionToElementEnd(n[0])}function o(e){/(<br(|\/)>)$/i.test(e.innerHTML.trim())?H.setSelectionBeforeElement(angular.element(e).find("br")[0]):H.setSelectionToElementEnd(e)}function x(e,t){t=angular.element("<"+t+">"+e[0].innerHTML+"</"+t+">"),e.after(t),e.remove(),o(t.find("li")[0])}function B(e,t,n){for(var r="",a=0;a<e.length;a++)r+="<"+w("li")+">"+e[a].innerHTML+"</"+w("li")+">";n=angular.element("<"+n+">"+r+"</"+n+">"),t.after(n),t.remove(),o(n.find("li")[0])}function R(e,t){for(var n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];r.tagName&&r.tagName.match(BLOCKELEMENTS)&&R(r,t)}if(null===e.parentNode)return e;if("<br>"===t)return e;var a=angular.element(t);return a[0].innerHTML=e.innerHTML,e.parentNode.insertBefore(a[0],e),e.parentNode.removeChild(e),a}return function(S,M){return S=w(S),function(e,t,n,r){var a,o;const l=y.rangy;var i,s=angular.element("<"+S+">");try{H.getSelection&&(d=H.getSelection()),void 0!==(o=H.getSelectionElement()).tagName&&("div"===o.tagName.toLowerCase()&&/taTextElement.+/.test(o.id)&&d&&d.start&&1===d.start.offset&&1===d.end.offset||"span"===o.tagName.toLowerCase()&&d&&d.start&&1===d.start.offset&&1===d.end.offset?(g=o.innerHTML,/<br>/i.test(g)&&(g=g.replace(/<br>/i,"&#8203;")),/<br\/>/i.test(g)&&(g=g.replace(/<br\/>/i,"&#8203;")),/<span>(<span>)+/i.test(g)&&(g=__.replace(/<span>(<span>)+/i,"<span>")),/<\/span>(<\/span>)+/i.test(g)&&(g=__.replace(/<\/span>(<\/span>)+/i,"</span>")),i="<div>"+(g=/<span><\/span>/i.test(g)?g.replace(/<span><\/span>/i,""):g)+"</div>",o.innerHTML=i,H.setSelectionToElementEnd(o.childNodes[0]),o=H.getSelectionElement()):"p"===o.tagName.toLowerCase()&&d&&d.start&&1===d.start.offset&&1===d.end.offset?(g=o.innerHTML,/<br>/i.test(g)&&(g=g.replace(/<br>/i,"&#8203;"),o.innerHTML=g)):"li"===o.tagName.toLowerCase()&&d&&d.start&&d.start.offset===d.end.offset&&(g=o.innerHTML,/<br>/i.test(g)&&(g=g.replace(/<br>/i,""),o.innerHTML=g)))}catch(e){}if(o){var d=angular.element(o),f=o&&o.tagName&&o.tagName.toLowerCase()||"";if("insertorderedlist"===e.toLowerCase()||"insertunorderedlist"===e.toLowerCase()){var c=w("insertorderedlist"===e.toLowerCase()?"ol":"ul"),g=H.getOnlySelectedElements();if(1<g.length&&("ol"===f||"ul"===f))return function(e,t,n,r,a){for(var o,l,i=e.find("li"),s=[],d=0;d<i.length;d++)for(o=0;o<t.length;o++)i[d].isEqualNode(t[o])&&(s[o]=d);0<s[0]&&(l=i[s[0]-1]),s[t.length-1]+1<i.length&&(g=i[s[t.length-1]+1]);var f="";if(r)for(o=0;o<t.length;o++)f+="<"+a+">"+t[o].innerHTML+"</"+a+">",t[o].remove();else{for(f+="<"+w(n)+">",o=0;o<t.length;o++)f+=t[o].outerHTML,t[o].remove();f+="</"+w(n)+">"}if(n=angular.element(f),l)if(g){var c="",g=e[0].nodeName.toLowerCase();for(c+="<"+g+">",d=0;d<s[0];d++)c+="<li>"+i[d].innerHTML+"</li>";c+="</"+g+">";var u="";for(u+="<"+g+">",d=s[t.length-1]+1;d<i.length;d++)u+="<li>"+i[d].innerHTML+"</li>";u+="</"+g+">",e.after(angular.element(u)),e.after(n),e.after(angular.element(c)),e.remove(),H.setSelectionToElementEnd(n[0])}else e.after(n),H.setSelectionToElementEnd(n[0]);else e.after(angular.element(e[0].outerHTML)),e.after(n),e.remove(),H.setSelectionToElementEnd(n[0])}(d,g,c,c===f,S);if(f===c)return d[0].childNodes.length!==g.length&&1===g.length?(d=angular.element(g[0]),A(d.parent(),d,c,!0,S)):O(d,S);if("li"===f&&d.parent()[0].tagName.toLowerCase()===c&&1===d.parent().children().length)return O(d.parent(),S);if("li"===f&&d.parent()[0].tagName.toLowerCase()!==c&&1===d.parent().children().length)return x(d.parent(),c);if(f.match(BLOCKELEMENTS)&&!d.hasClass("ta-bind")){if(g.length&&d[0].childNodes.length!==g.length&&1===g.length)return d=angular.element(g[0]),A(d.parent(),d,c,c===f,S);if("ol"===f||"ul"===f)return x(d,c);var u=!1;return angular.forEach(d.children(),function(e){e.tagName.match(BLOCKELEMENTS)&&(u=!0)}),B(u?d.children():[angular.element("<div>"+o.innerHTML+"</div>")[0]],d,c)}if(f.match(BLOCKELEMENTS)){if(0===(L=H.getOnlySelectedElements()).length)a=angular.element("<"+c+"><li>"+o.innerHTML+"</li></"+c+">"),d.html(""),d.append(a);else{if(1===L.length&&("ol"===L[0].tagName.toLowerCase()||"ul"===L[0].tagName.toLowerCase()))return L[0].tagName.toLowerCase()===c?O(angular.element(L[0]),S):x(angular.element(L[0]),c);for(var m,h="",N=[],p=0;p<L.length;p++)3!==L[p].nodeType&&(m=angular.element(L[p]),"li"!==L[p].tagName.toLowerCase()&&("ol"===L[p].tagName.toLowerCase()||"ul"===L[p].tagName.toLowerCase()?h+=m[0].innerHTML:"span"!==L[p].tagName.toLowerCase()||"ol"!==L[p].childNodes[0].tagName.toLowerCase()&&"ul"!==L[p].childNodes[0].tagName.toLowerCase()?h+="<"+w("li")+">"+m[0].innerHTML+"</"+w("li")+">":h+=m[0].childNodes[0].innerHTML,N.unshift(m)));a=angular.element("<"+c+">"+h+"</"+c+">"),N.pop().replaceWith(a),angular.forEach(N,function(e){e.remove()})}return void H.setSelectionToElementEnd(a[0])}}else{if("formatblock"===e.toLowerCase()){for("default"===(c=n.toLowerCase().replace(/[<>]/gi,"")).trim()&&(n="<"+(c=S)+">"),a="li"===f?d.parent():d;!a[0].tagName||!a[0].tagName.match(BLOCKELEMENTS)&&!a.parent().attr("contenteditable");)f=((a=a.parent())[0].tagName||"").toLowerCase();if(f===c){var L=a.children(),E=!1;for(p=0;p<L.length;p++)E=E||L[p].tagName.match(BLOCKELEMENTS);a=E?(a.after(L),d=a.next(),a.remove(),d):(s.append(a[0].childNodes),a.after(s),a.remove(),s)}else if(a.parent()[0].tagName.toLowerCase()!==c||a.parent().hasClass("ta-bind"))if(f.match(LISTELEMENTS))a.wrap(n);else{for(0===(L=H.getOnlySelectedElements()).length&&(L=[a[0]]),p=0;p<L.length;p++)if(3===L[p].nodeType||!L[p].tagName.match(BLOCKELEMENTS))for(;3===L[p].nodeType||!L[p].tagName||!L[p].tagName.match(BLOCKELEMENTS);)L[p]=L[p].parentNode;if(1<(L=L.filter(function(e,t,n){return n.indexOf(e)===t})).length&&(L=L.filter(function(e,t,n){return!("div"===e.nodeName.toLowerCase()&&/^taTextElement/.test(e.id))})),angular.element(L[0]).hasClass("ta-bind"))(a=angular.element(n))[0].innerHTML=L[0].innerHTML,L[0].innerHTML=a[0].outerHTML;else if("blockquote"===c){for(h="",p=0;p<L.length;p++)h+=L[p].outerHTML;for((a=angular.element(n))[0].innerHTML=h,L[0].parentNode.insertBefore(a[0],L[0]),p=L.length-1;0<=p;p--)L[p].parentNode&&L[p].parentNode.removeChild(L[p])}else if("pre"===c&&H.getStateShiftKey()){for(h="",p=0;p<L.length;p++)h+=L[p].outerHTML;for((a=angular.element(n))[0].innerHTML=h,L[0].parentNode.insertBefore(a[0],L[0]),p=L.length-1;0<=p;p--)L[p].parentNode&&L[p].parentNode.removeChild(L[p])}else for(p=0;p<L.length;p++){var v=R(L[p],n);L[p]===a[0]&&(a=angular.element(v))}}else{var C=a.parent(),T=C.contents();for(p=0;p<T.length;p++)C.parent().hasClass("ta-bind")&&3===T[p].nodeType&&((s=angular.element("<"+S+">"))[0].innerHTML=T[p].outerHTML,T[p]=s[0]),C.parent()[0].insertBefore(T[p],C[0]);C.remove()}return H.setSelectionToElementEnd(a[0]),void a[0].focus()}if("createlink"===e.toLowerCase()){if("a"===f)return void(H.getSelectionElement().href=n);var r='<a href="'+n+'" target="'+(r.a.target||"")+'">';return void(H.getSelection().collapsed?H.insertHtml(r+n+"</a>",M):l.getSelection().getRangeAt(0).canSurroundContents()&&(r=angular.element(r+"</a>")[0],l.getSelection().getRangeAt(0).surroundContents(r)))}if("inserthtml"===e.toLowerCase())return void H.insertHtml(n,M)}try{b[0].execCommand(e,t,n)}catch(e){}}}}}]).service("taSelection",["$document","taDOM","$log","$rangy",function(e,p,t,n){const L=n.rangy;function r(e,t){return e.tagName&&e.tagName.match(/^br$/i)&&0===t&&!e.previousSibling?{element:e.parentNode,offset:0}:{element:e,offset:t}}var a,E=e[0],v={getSelection:function(){try{t=L.getSelection().getRangeAt(0)}catch(e){return}var e=t.commonAncestorContainer,t={start:r(t.startContainer,t.startOffset),end:r(t.endContainer,t.endOffset),collapsed:t.collapsed};return 3===e.nodeType&&("div"===e.parentNode.nodeName.toLowerCase()&&/^taTextElement/.test(e.parentNode.id)||(e=e.parentNode)),"div"===e.nodeName.toLowerCase()&&/^taTextElement/.test(e.id)?(t.start.element=e.childNodes[t.start.offset],t.end.element=e.childNodes[t.end.offset],t.container=e):e.parentNode===t.start.element||e.parentNode===t.end.element?t.container=e.parentNode:t.container=e,t},updateLeftArrowKey:function(e){var t=L.getSelection().getRangeAt(0);if(t&&t.collapsed){var n=v.getFlattenedDom(t);if(!n.findIndex)return;var r,a,o=t.startContainer,l=n.findIndex(function(e,t){return e.node===o||-1!==e.parents.indexOf(o)});if(n.forEach(function(e,t){e.parents.forEach(function(e,t){})}),(r=l+1<n.length?n[l+1].node:r)&&r.textContent&&/^\ufeff([^\ufeff]*)$/.exec(r.textContent))return;if(0<l&&(a=n[l-1].node),0===t.startOffset&&a&&/^\ufeff([^\ufeff]*)$/.exec(a.textContent))return void v.setSelectionToElementEnd(a)}},updateRightArrowKey:function(e){},getFlattenedDom:function(e){var t=e.commonAncestorContainer.parentNode;if(!t)return e.commonAncestorContainer.childNodes;var a=Array.prototype.slice.call(t.childNodes),e=a.indexOf(e.startContainer);return e+1<a.length&&0<e||t.parentNode&&(t=t.parentNode),a=[],function n(r){r.node.childNodes.length?Array.prototype.slice.call(r.node.childNodes).forEach(function(e){var t=r.parents.slice();t.slice(-1)[0]!==r.node&&t.push(r.node),n({parents:t,node:e})}):a.push({parents:r.parents,node:r.node})}({parents:[t],node:t}),a},getOnlySelectedElements:function(){var e=L.getSelection().getRangeAt(0),t=3===(t=e.commonAncestorContainer).nodeType?t.parentNode:t;return e.getNodes([1],function(e){return e.parentNode===t})},getAllSelectedElements:function(){var e=L.getSelection().getRangeAt(0),t=3===(t=e.commonAncestorContainer).nodeType?t.parentNode:t,n=e.getNodes([1],function(e){return e.parentNode===t});if(t.innerHTML.replace(/<span id=.selectionBoundary[^>]+>\ufeff?<\/span>/gi,"")===e.toHtml()&&("div"!==t.nodeName.toLowerCase()||!/^taTextElement/.test(t.id))){for(var r=[],a=n.length;a--;r.unshift(n[a]));(n=r).push(t)}return n},getSelectionElement:function(){if(v.getSelection())return v.getSelection().container},setSelection:function(e,t,n,r){var a=L.createRange();a.setStart(e,n),a.setEnd(t,r),L.getSelection().setSingleRange(a)},setSelectionBeforeElement:function(e){var t=L.createRange();t.selectNode(e),t.collapse(!0),L.getSelection().setSingleRange(t)},setSelectionAfterElement:function(e){var t=L.createRange();t.selectNode(e),t.collapse(!1),L.getSelection().setSingleRange(t)},setSelectionToElementStart:function(e){var t=L.createRange();t.selectNodeContents(e),t.collapse(!0),L.getSelection().setSingleRange(t)},setSelectionToElementEnd:function(e){var t=L.createRange();t.selectNodeContents(e),t.collapse(!1),e.childNodes&&e.childNodes[e.childNodes.length-1]&&"br"===e.childNodes[e.childNodes.length-1].nodeName&&(t.startOffset=t.endOffset=t.startOffset-1),L.getSelection().setSingleRange(t)},setStateShiftKey:function(e){a=e},getStateShiftKey:function(){return a},insertHtml:function(e,t){var n,r,a,o,l,i=angular.element("<div>"+e+"</div>"),s=L.getSelection().getRangeAt(0),d=E.createDocumentFragment(),f=i[0].childNodes,c=!0;if(0<f.length){for(r=[],n=0;n<f.length;n++){var g=f[n];"p"===g.nodeName.toLowerCase()&&""===g.innerHTML.trim()||(c=c&&!BLOCKELEMENTS.test(g.nodeName),r.push(g))}for(var u=0;u<r.length;u++)o=d.appendChild(r[u]);!c&&s.collapsed&&/^(|<br(|\/)>)$/i.test(s.startContainer.innerHTML)&&s.selectNode(s.startContainer)}else c=!0,o=d=E.createTextNode(e);if(c)s.deleteContents();else if(s.collapsed&&s.startContainer!==t)if(s.startContainer.innerHTML&&s.startContainer.innerHTML.match(/^<[^>]*>$/i))m=s.startContainer,1===s.startOffset?(s.setStartAfter(m),s.setEndAfter(m)):(s.setStartBefore(m),s.setEndBefore(m));else{if(3===s.startContainer.nodeType&&s.startContainer.parentNode!==t)for(N=(m=s.startContainer.parentNode).cloneNode(),p.splitNodes(m.childNodes,m,N,s.startContainer,s.startOffset);!VALIDELEMENTS.test(m.nodeName);){angular.element(m).after(N);var m,h=N,N=(m=m.parentNode).cloneNode();p.splitNodes(m.childNodes,m,N,h)}else N=(m=s.startContainer).cloneNode(),p.splitNodes(m.childNodes,m,N,void 0,void 0,s.startOffset);if(angular.element(m).after(N),s.setStartAfter(m),s.setEndAfter(m),/^(|<br(|\/)>)$/i.test(m.innerHTML.trim())&&(s.setStartBefore(m),s.setEndBefore(m),angular.element(m).remove()),/^(|<br(|\/)>)$/i.test(N.innerHTML.trim())&&angular.element(N).remove(),"li"===m.nodeName.toLowerCase()){for(l=E.createDocumentFragment(),a=0;a<d.childNodes.length;a++)i=angular.element("<li>"),p.transferChildNodes(d.childNodes[a],i[0]),p.transferNodeAttributes(d.childNodes[a],i[0]),l.appendChild(i[0]);d=l,o=o&&(o=d.childNodes[d.childNodes.length-1]).childNodes[o.childNodes.length-1]}}else s.deleteContents();s.insertNode(d),o&&v.setSelectionToElementEnd(o)}};return v}]).service("taDOM",function(){var d={getByAttribute:function(e,t){var n=[],r=e.children();return r.length&&angular.forEach(r,function(e){n=n.concat(d.getByAttribute(angular.element(e),t))}),void 0!==e.attr(t)&&n.push(e),n},transferChildNodes:function(e,t){for(t.innerHTML="";0<e.childNodes.length;)t.appendChild(e.childNodes[0]);return t},splitNodes:function(e,t,n,r,a,o){if(!r&&isNaN(o))throw new Error("taDOM.splitNodes requires a splitNode or splitIndex");for(var l=document.createDocumentFragment(),i=document.createDocumentFragment(),s=0;0<e.length&&(isNaN(o)||o!==s)&&e[0]!==r;)l.appendChild(e[0]),s++;for(!isNaN(a)&&0<=a&&e[0]&&(l.appendChild(document.createTextNode(e[0].nodeValue.substring(0,a))),e[0].nodeValue=e[0].nodeValue.substring(a));0<e.length;)i.appendChild(e[0]);d.transferChildNodes(l,t),d.transferChildNodes(i,n)},transferNodeAttributes:function(e,t){for(var n=0;n<e.attributes.length;n++)t.setAttribute(e.attributes[n].name,e.attributes[n].value);return t}};return d});
angular.module("angularjstexteditor.validators",[]).directive("taMaxText",function(){return{restrict:"A",require:"ngModel",link:function(t,e,n,a){var i=parseInt(t.$eval(n.taMaxText));if(isNaN(i))throw"Max text must be an integer";n.$observe("taMaxText",function(t){if(i=parseInt(t),isNaN(i))throw"Max text must be an integer";a.$dirty&&a.$validate()}),a.$validators.taMaxText=function(t){var e=angular.element("<div/>");return e.html(t),e.text().length<=i}}}}).directive("taMinText",function(){return{restrict:"A",require:"ngModel",link:function(t,e,n,a){var i=parseInt(t.$eval(n.taMinText));if(isNaN(i))throw"Min text must be an integer";n.$observe("taMinText",function(t){if(i=parseInt(t),isNaN(i))throw"Min text must be an integer";a.$dirty&&a.$validate()}),a.$validators.taMinText=function(t){var e=angular.element("<div/>");return e.html(t),!e.text().length||e.text().length>=i}}}});
angular.module("angularjstexteditor.taBind",["angularjstexteditor.factories","angularjstexteditor.DOM"]).service("_taBlankTest",[function(){return function(e){return!e||""===stripHtmlToText(e)&&!/<img[^>]+>/.test(e)}}]).directive("taButton",[function(){return{link:function(e,t,a){t.attr("unselectable","on"),t.on("mousedown",function(e,t){return t&&angular.extend(e,t),e.preventDefault(),!1})}}}]).directive("taBind",["taSanitize","$timeout","$document","taFixChrome","taBrowserTag","taSelection","taSelectableElements","taApplyCustomRenderers","taOptions","_taBlankTest","$parse","taDOM","angularjstexteditorManager","$rangy",function(O,F,z,P,e,j,q,G,J,Q,X,t,Y,Z){return{priority:2,require:["ngModel","?ngModelOptions"],link:function(g,y,s,e){const d=Z.rangy;var i,b,u,C=e[0],l=e[1]||{},n=void 0!==y.attr("contenteditable")&&y.attr("contenteditable"),t=n||"textarea"===y[0].tagName.toLowerCase()||"input"===y[0].tagName.toLowerCase(),c=!1,a=!1,r=!1,w=s.taUnsafeSanitizer||J.disableSanitizer,o=s.taKeepStyles||J.keepStyles,p=/^(9|19|20|27|33|34|35|36|37|38|39|40|45|112|113|114|115|116|117|118|119|120|121|122|123|144|145)$/i,f=/^(8|13|32|46|59|61|107|109|173|186|187|188|189|190|191|192|219|220|221|222)$/i,m=[{specialKey:"UndoKey",forbiddenModifiers:12,mustHaveModifiers:[3],keyCode:90},{specialKey:"RedoKey",forbiddenModifiers:4,mustHaveModifiers:[3,8],keyCode:90},{specialKey:"RedoKey",forbiddenModifiers:12,mustHaveModifiers:[3],keyCode:89},{specialKey:"TabKey",forbiddenModifiers:15,mustHaveModifiers:[],keyCode:9},{specialKey:"ShiftTabKey",forbiddenModifiers:7,mustHaveModifiers:[8],keyCode:9}];void 0===s.taDefaultWrap&&(s.taDefaultWrap="p"),""===s.taDefaultWrap?(u="",void 0===_browserDetect.ie||11<=_browserDetect.ie||_browserDetect.ie):(u=void 0===_browserDetect.ie||11<=_browserDetect.ie?"br"===s.taDefaultWrap.toLowerCase()?"<BR><BR>":"<"+s.taDefaultWrap+"><br></"+s.taDefaultWrap+">":_browserDetect.ie<=8?"<"+s.taDefaultWrap.toUpperCase()+"></"+s.taDefaultWrap.toUpperCase()+">":"<"+s.taDefaultWrap+"></"+s.taDefaultWrap+">",void 0===_browserDetect.ie||11<=_browserDetect.ie?"br"===s.taDefaultWrap.toLowerCase()||(s.taDefaultWrap,s.taDefaultWrap):_browserDetect.ie<=8?(s.taDefaultWrap.toUpperCase(),s.taDefaultWrap.toUpperCase()):(s.taDefaultWrap,s.taDefaultWrap)),l.$options||(l.$options={});function h(e){if(Q(e))return e;var t=angular.element("<div>"+e+"</div>");if(0===t.children().length)e="<"+s.taDefaultWrap+">"+e+"</"+s.taDefaultWrap+">";else{for(var a=t[0].childNodes,n=!1,r=0;r<a.length&&!(n=a[r].nodeName.toLowerCase().match(BLOCKELEMENTS));r++);if(n)for(e="",r=0;r<a.length;r++){var o,i=a[r],l=i.nodeName.toLowerCase();"#comment"===l?e+="\x3c!--"+i.nodeValue+"--\x3e":"#text"===l?(o=i.textContent).trim()?e+="<"+s.taDefaultWrap+">"+o+"</"+s.taDefaultWrap+">":e+=o:l.match(BLOCKELEMENTS)?e+=i.outerHTML:""!==(i=i.outerHTML||i.nodeValue).trim()?e+="<"+s.taDefaultWrap+">"+i+"</"+s.taDefaultWrap+">":e+=i}else e="<"+s.taDefaultWrap+">"+e+"</"+s.taDefaultWrap+">"}return e}var v;s.taPaste&&(b=X(s.taPaste)),y.addClass("ta-bind"),g["$undoManager"+(s.id||"")]=C.$undoManager={_stack:[],_index:0,_max:1e3,push:function(e){return null==e||void 0!==this.current()&&null!==this.current()&&e===this.current()||(this._index<this._stack.length-1&&(this._stack=this._stack.slice(0,this._index+1)),this._stack.push(e),v&&F.cancel(v),this._stack.length>this._max&&this._stack.shift(),this._index=this._stack.length-1),e},undo:function(){return this.setToIndex(this._index-1)},redo:function(){return this.setToIndex(this._index+1)},setToIndex:function(e){if(!(e<0||e>this._stack.length-1))return this._index=e,this.current()},current:function(){return this._stack[this._index]}};function L(){if(n)return y[0].innerHTML;if(t)return y.val();throw"angularjstexteditor Error: attempting to update non-editable taBind"}function D(e){return g.$emit("ta-element-select",this),e.preventDefault(),!1}function k(e,t,a){r=a||!1,null==t&&(t=n),null==e&&(e=L()),Q(e)?(""!==C.$viewValue&&C.$setViewValue(""),t&&""!==C.$undoManager.current()&&C.$undoManager.push("")):(x(),C.$viewValue!==e&&(C.$setViewValue(e),t&&C.$undoManager.push(e))),C.$render()}function M(e){y[0].innerHTML=e}var N,x=g["reApplyOnSelectorHandlers"+(s.id||"")]=function(){c||angular.forEach(q,function(e){y.find(e).off("click",D).on("click",D)})},K=g["$undoTaBind"+(s.id||"")]=function(){var e;c||!n||null!=(e=C.$undoManager.undo())&&(M(e),k(e,!1),N&&F.cancel(N),N=F(function(){y[0].focus(),j.setSelectionToElementEnd(y[0])},1))},S=g["$redoTaBind"+(s.id||"")]=function(){var e;c||!n||null!=(e=C.$undoManager.redo())&&(M(e),k(e,!1),N&&F.cancel(N),N=F(function(){y[0].focus(),j.setSelectionToElementEnd(y[0])},1))};g["updateTaBind"+(s.id||"")]=function(){c||k(void 0,void 0,!0)};function $(e){return C.$oldViewValue=O(P(e,o),C.$oldViewValue,w)}if(y.attr("required")&&(C.$validators.required=function(e,t){return!Q(e||t)}),C.$parsers.push($),C.$parsers.unshift(h),C.$formatters.push($),C.$formatters.unshift(h),C.$formatters.unshift(function(e){return C.$undoManager.push(e||"")}),t)if(g.events={},n){function T(e){var t=void 0!==e&&e.match(/content=["']*OneNote.File/i);if(e&&e.trim().length){if(e.match(/class=["']*Mso(Normal|List)/i)||e.match(/content=["']*Word.Document/i)||e.match(/content=["']*OneNote.File/i)){var a=e.match(/<!--StartFragment-->([\s\S]*?)<!--EndFragment-->/i);a=(a=a?a[1]:e).replace(/<o:p>[\s\S]*?<\/o:p>/gi,"").replace(/class=(["']|)MsoNormal(["']|)/gi,"");var n=angular.element("<div>"+a+"</div>"),r=angular.element("<div></div>"),o={element:null,lastIndent:[],lastLi:null,isUl:!1};o.lastIndent.peek=function(){var e=this.length;if(0<e)return this[e-1]};function i(e){o.isUl=e,o.element=angular.element(e?"<ul>":"<ol>"),o.lastIndent=[],o.lastIndent.peek=function(){var e=this.length;if(0<e)return this[e-1]},o.lastLevelMatch=null}for(var l=0;l<=n[0].childNodes.length;l++)if(n[0].childNodes[l]&&"#text"!==n[0].childNodes[l].nodeName){var s=n[0].childNodes[l].tagName.toLowerCase();if("p"===s||"ul"===s||"h1"===s||"h2"===s||"h3"===s||"h4"===s||"h5"===s||"h6"===s||"table"===s){var d=angular.element(n[0].childNodes[l]),u=(d.attr("class")||"").match(/MsoList(Bullet|Number|Paragraph)(CxSp(First|Middle|Last)|)/i);if(u){if(!(d[0].childNodes.length<2||d[0].childNodes[1].childNodes.length<1)){var c="bullet"===u[1].toLowerCase()||"number"!==u[1].toLowerCase()&&!(/^[^0-9a-z<]*[0-9a-z]+[^0-9a-z<>]</i.test(d[0].childNodes[1].innerHTML)||/^[^0-9a-z<]*[0-9a-z]+[^0-9a-z<>]</i.test(d[0].childNodes[1].childNodes[0].innerHTML)),s=(d.attr("style")||"").match(/margin-left:([\-\.0-9]*)/i),p=parseFloat(s?s[1]:0),s=(d.attr("style")||"").match(/mso-list:l([0-9]+) level([0-9]+) lfo[0-9+]($|;)/i);if(s&&s[2]&&(p=parseInt(s[2])),s&&(!o.lastLevelMatch||s[1]!==o.lastLevelMatch[1])||!u[3]||"first"===u[3].toLowerCase()||null===o.lastIndent.peek()||o.isUl!==c&&o.lastIndent.peek()===p)i(c),r.append(o.element);else if(null!=o.lastIndent.peek()&&o.lastIndent.peek()<p)o.element=angular.element(c?"<ul>":"<ol>"),o.lastLi.append(o.element);else if(null!=o.lastIndent.peek()&&o.lastIndent.peek()>p){for(;null!=o.lastIndent.peek()&&o.lastIndent.peek()>p;)if("li"!==o.element.parent()[0].tagName.toLowerCase()){if(!/[uo]l/i.test(o.element.parent()[0].tagName.toLowerCase()))break;o.element=o.element.parent(),o.lastIndent.pop()}else o.element=o.element.parent();o.isUl="ul"===o.element[0].tagName.toLowerCase(),c!==o.isUl&&(i(c),r.append(o.element))}o.lastLevelMatch=s,p!==o.lastIndent.peek()&&o.lastIndent.push(p),o.lastLi=angular.element("<li>"),o.element.append(o.lastLi),o.lastLi.html(d.html().replace(/<!(--|)\[if !supportLists\](--|)>[\s\S]*?<!(--|)\[endif\](--|)>/gi,"")),d.remove()}}else i(!1),r.append(d)}}function f(e){for(var t=(e=angular.element(e))[0].childNodes.length-1;0<=t;t--)e.after(e[0].childNodes[t]);e.remove()}angular.forEach(r.find("span"),function(e){e.removeAttribute("lang"),e.attributes.length<=0&&f(e)}),angular.forEach(r.find("font"),f),e=r.html(),e=(e=t?r.html()||n.html():e).replace(/\n/g," ")}else{if((e=e.replace(/<(|\/)meta[^>]*?>/gi,"")).match(/<[^>]*?(ta-bind)[^>]*?>/)){if(e.match(/<[^>]*?(angularjstexteditor)[^>]*?>/)){t=angular.element("<div>"+e+"</div>");t.find("textarea").remove();for(var m=0;m<binds.length;m++){for(var h=binds[m][0].parentNode.parentNode,v=0;v<binds[m][0].childNodes.length;v++)h.parentNode.insertBefore(binds[m][0].childNodes[v],h);h.parentNode.removeChild(h)}e=t.html().replace('<br class="Apple-interchange-newline">',"")}}else e.match(/^<span/)&&(e.match(/<span class=(\"Apple-converted-space\"|\'Apple-converted-space\')>.<\/span>/gi)||(e=e.replace(/<(|\/)span[^>]*?>/gi,"")));e=e.replace(/<br class="Apple-interchange-newline"[^>]*?>/gi,"").replace(/<span class="Apple-converted-space">( |&nbsp;)<\/span>/gi,"&nbsp;")}e=(e=/<li(\s.*)?>/i.test(e)&&!1===/(<ul(\s.*)?>|<ol(\s.*)?>).*<li(\s.*)?>/i.test(e)?e.replace(/<li(\s.*)?>.*<\/li(\s.*)?>/i,"<ul>$&</ul>"):e).replace(/^[ |\u00A0]+/gm,function(e){for(var t="",a=0;a<e.length;a++)t+="&nbsp;";return t}).replace(/\n|\r\n|\r/g,"<br />").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;"),e=(e=b?b(g,{$html:e})||e:e).replace(/<span style=("|')([^<]*?)vertical-align\s*:\s*super;?([^>]*?)("|')>([^<]+?)<\/span>/g,"<sup style='$2$3'>$5</sup>"),e=O(e,"",w),j.insertHtml(e,y[0]),F(function(){C.$setViewValue(L()),W=!1,y.removeClass("processing-paste")},0)}else W=!1,y.removeClass("processing-paste")}var E,_,H,W=!1;if(y.on("paste",g.events.paste=function(e,t){if(t&&angular.extend(e,t),c||W)return e.stopPropagation(),e.preventDefault(),!1;var a;W=!0,y.addClass("processing-paste");var n=(e.originalEvent||e).clipboardData;if(!n&&window.clipboardData&&window.clipboardData.getData)return a=window.clipboardData.getData("Text"),T(a),e.stopPropagation(),e.preventDefault(),!1;if(n&&n.getData&&0<n.types.length){for(var r="",o=0;o<n.types.length;o++)r+=" "+n.types[o];return/text\/html/i.test(r)?a=n.getData("text/html"):/text\/plain/i.test(r)&&(a=n.getData("text/plain")),T(a),e.stopPropagation(),e.preventDefault(),!1}var i=d.saveSelection(),l=angular.element('<div class="ta-hidden-input" contenteditable="true"></div>');z.find("body").append(l),l[0].focus(),F(function(){d.restoreSelection(i),T(l[0].innerHTML),y[0].focus(),l.remove()},0)}),y.on("cut",g.events.cut=function(e){c?e.preventDefault():F(function(){C.$setViewValue(L())},0)}),y.on("keydown",g.events.keydown=function(t,e){var a,n,r,o,i,l;e&&angular.extend(t,e),16===t.keyCode?j.setStateShiftKey(!0):j.setStateShiftKey(!1),t.specialKey=(a=t,m.forEach(function(e){var t;e.keyCode===a.keyCode&&(t=(a.metaKey?2:0)+(a.ctrlKey?1:0)+(a.shiftKey?8:0)+(a.altKey?4:0),e.forbiddenModifiers&t||e.mustHaveModifiers.every(function(e){return t&e})&&(n=e.specialKey))}),n),J.keyMappings.forEach(function(e){t.specialKey===e.commandKeyCode&&(t.specialKey=void 0),e.testForKey(t)&&(r=e.commandKeyCode),"UndoKey"!==e.commandKeyCode&&"RedoKey"!==e.commandKeyCode||e.enablePropagation||t.preventDefault()}),void 0!==r&&(t.specialKey=r),void 0===t.specialKey||"UndoKey"===t.specialKey&&"RedoKey"===t.specialKey||(t.preventDefault(),Y.sendKeyCommand(g,t)),c||("UndoKey"===t.specialKey&&(K(),t.preventDefault()),"RedoKey"===t.specialKey&&(S(),t.preventDefault()),13!==t.keyCode||t.shiftKey||t.ctrlKey||t.metaKey||t.altKey||(o=j.getSelectionElement()).nodeName.match(VALIDELEMENTS)&&(i=angular.element(u),function(e,t){for(var a=0;a<e.length;a++)if(e[a]===t)return!0;return!1}(["blockquote","ul","ol"],o.parentNode.tagName.toLowerCase())&&(/^<br(|\/)>$/i.test(o.innerHTML.trim())&&!o.nextSibling&&((e=(l=angular.element(o)).parent()).after(i),l.remove(),0===e.children().length&&e.remove(),j.setSelectionToElementStart(i[0]),t.preventDefault()),/^<[^>]+><br(|\/)><\/[^>]+>$/i.test(o.innerHTML.trim())&&((l=angular.element(o)).after(i),l.remove(),j.setSelectionToElementStart(i[0]),t.preventDefault()))))}),y.on("keyup",g.events.keyup=function(e,t){if(t&&angular.extend(e,t),j.setStateShiftKey(!1),9!==e.keyCode){if(37!==e.keyCode||e.shiftKey||j.updateLeftArrowKey(y),39!==e.keyCode||e.shiftKey||j.updateRightArrowKey(y),v&&F.cancel(v),!(c||p.test(e.keyCode)||13===e.keyCode&&(e.ctrlKey||e.metaKey||e.altKey))){if(""!==u&&"<BR><BR>"!==u&&13===e.keyCode&&!e.ctrlKey&&!e.metaKey&&!e.altKey){for(var a,n=j.getSelectionElement();!n.nodeName.match(VALIDELEMENTS)&&n!==y[0];)n=n.parentNode;e.shiftKey?(t=n.tagName.toLowerCase())!==s.taDefaultWrap&&"li"!==t&&"pre"!==t&&"div"!==t||/.+<br><br>/.test(n.innerHTML.trim())||(a=n.previousSibling)&&(a.innerHTML=a.innerHTML+"<br><br>",angular.element(n).remove(),j.setSelectionToElementEnd(a)):n.tagName.toLowerCase()===s.taDefaultWrap||"li"===n.nodeName.toLowerCase()||""!==n.innerHTML.trim()&&"<br>"!==n.innerHTML.trim()||(a=angular.element(u),angular.element(n).replaceWith(a),j.setSelectionToElementStart(a[0]))}var r=L();""===u||""!==r.trim()&&"<br>"!==r.trim()?"<"!==r.substring(0,1)&&s.taDefaultWrap:(M(u),j.setSelectionToElementStart(y.children()[0]));var o=i!==e.keyCode&&f.test(e.keyCode);E&&F.cancel(E),E=F(function(){k(r,o,!0)},l.$options.debounce||400),o||(v=F(function(){C.$undoManager.push(r)},250)),i=e.keyCode}}else j.getSelection().start.element===y[0]&&y.children().length&&j.setSelectionToElementStart(y.children()[0])}),y.on("input",function(){L()!==C.$viewValue&&(_&&F.cancel(_),_=F(function(){var e=d.saveSelection(),t=L();t!==C.$viewValue&&k(t,!0),0!==C.$viewValue.length&&d.restoreSelection(e)},1e3))}),y.on("blur",g.events.blur=function(){a=!1,c?(r=!0,C.$render()):k(void 0,void 0,!0)}),s.placeholder&&(8<_browserDetect.ie||void 0===_browserDetect.ie)){if(!s.id)throw"angularjstexteditor Error: An unique ID is required for placeholders to work";H=addCSSRule("#"+s.id+".placeholder-text:before",'content: "'+s.placeholder+'"'),g.$on("$destroy",function(){removeCSSRule(H)})}y.on("focus",g.events.focus=function(){a=!0,y.removeClass("placeholder-text"),x()}),y.on("mouseup",g.events.mouseup=function(){var e=j.getSelection();e&&e.start.element===y[0]&&y.children().length&&j.setSelectionToElementStart(y.children()[0])}),y.on("mousedown",g.events.mousedown=function(e,t){t&&angular.extend(e,t),e.stopPropagation()})}else{y.on("change blur",g.events.change=g.events.blur=function(){c||C.$setViewValue(L())}),y.on("keydown",g.events.keydown=function(e,t){var a,n,r,o;t&&angular.extend(e,t),9===e.keyCode&&(a=this.selectionStart,n=this.selectionEnd,r=y.val(),e.shiftKey?(o=r.lastIndexOf("\n",a),-1!==(t=r.lastIndexOf("\t",a))&&o<=t&&(y.val(r.substring(0,t)+r.substring(t+1)),this.selectionStart=this.selectionEnd=a-1)):(y.val(r.substring(0,a)+"\t"+r.substring(n)),this.selectionStart=this.selectionEnd=a+1),e.preventDefault())});function V(e,t){for(var a="",n=0;n<t;n++)a+=e;return a}function I(e,t,a){for(var n=0;n<e.length;n++)t.call(a,n,e[n])}function A(e,n){var r="",t=e.childNodes;return r+=V("\t",++n-1)+e.outerHTML.substring(0,4),I(t,function(e,t){var a=t.nodeName.toLowerCase();"#comment"!==a?"#text"!==a?t.outerHTML&&(r+="ul"===a||"ol"===a?"\n"+A(t,n):"\n"+V("\t",n)+t.outerHTML):r+=t.textContent:r+="\x3c!--"+t.nodeValue+"--\x3e"}),r+="\n"+V("\t",n-1)+e.outerHTML.substring(e.outerHTML.lastIndexOf("<"))}C.$formatters.unshift(function(n){var e=angular.element("<div>"+n+"</div>")[0].childNodes;return 0<e.length&&(n="",I(e,function(e,t){var a=t.nodeName.toLowerCase();"#comment"!==a?"#text"!==a?t.outerHTML&&(0<n.length&&(n+="\n"),n+="ul"===a||"ol"===a?""+A(t,0):""+t.outerHTML):n+=t.textContent:n+="\x3c!--"+t.nodeValue+"--\x3e"})),n})}function B(e,t){t&&angular.extend(e,t),dropFired||c||(dropFired=!0,t=(e.originalEvent||e).dataTransfer,g.$emit("ta-drop-event",this,e,t),F(function(){dropFired=!1,k(void 0,void 0,!0)},100))}var R,U=!1;C.$render=function(){var e;U||(U=!0,e=C.$viewValue||"",r||(n&&a&&(y.removeClass("placeholder-text"),R&&F.cancel(R),R=F(function(){a||(y[0].focus(),j.setSelectionToElementEnd(y.children()[y.children().length-1])),R=void 0},1)),n?(s.placeholder,M(""===e?u:e),c?y.off("drop",B):(x(),y.on("drop",B))):"textarea"!==y[0].tagName.toLowerCase()&&"input"!==y[0].tagName.toLowerCase()?M(G(e)):y.val(e)),n&&s.placeholder&&(""!==e||a?y.removeClass("placeholder-text"):y.addClass("placeholder-text")),U=r=!1)},s.taReadonly&&((c=g.$eval(s.taReadonly))?(y.addClass("ta-readonly"),"textarea"!==y[0].tagName.toLowerCase()&&"input"!==y[0].tagName.toLowerCase()||y.attr("disabled","disabled"),void 0!==y.attr("contenteditable")&&y.attr("contenteditable")&&y.removeAttr("contenteditable")):(y.removeClass("ta-readonly"),"textarea"===y[0].tagName.toLowerCase()||"input"===y[0].tagName.toLowerCase()?y.removeAttr("disabled"):n&&y.attr("contenteditable","true")),g.$watch(s.taReadonly,function(e,t){t!==e&&(e?(y.addClass("ta-readonly"),"textarea"!==y[0].tagName.toLowerCase()&&"input"!==y[0].tagName.toLowerCase()||y.attr("disabled","disabled"),void 0!==y.attr("contenteditable")&&y.attr("contenteditable")&&y.removeAttr("contenteditable"),angular.forEach(q,function(e){y.find(e).on("click",D)}),y.off("drop",B)):(y.removeClass("ta-readonly"),"textarea"===y[0].tagName.toLowerCase()||"input"===y[0].tagName.toLowerCase()?y.removeAttr("disabled"):n&&y.attr("contenteditable","true"),angular.forEach(q,function(e){y.find(e).off("click",D)}),y.on("drop",B)),c=e)})),n&&!c&&(angular.forEach(q,function(e){y.find(e).on("click",D)}),y.on("drop",B))}}}]);
var dropFired=!1,angularjstexteditor=angular.module("angularjstexteditor",["angularjstexteditorRangy","ngSanitize","angularjstexteditorSetup","angularjstexteditor.factories","angularjstexteditor.DOM","angularjstexteditor.validators","angularjstexteditor.taBind"]);angularjstexteditor.config([function(){angular.forEach(taTools,function(e,t){delete taTools[t]})}]),angularjstexteditor.directive("angularjstexteditor",["$compile","$timeout","taOptions","taSelection","taExecCommand","angularjstexteditorManager","$document","$animate","$log","$q","$parse","$rangy",function(T,w,C,$,z,A,H,D,_,j,k,W){return{require:"?ngModel",scope:{},restrict:"EA",priority:2,link:function(d,t,c,a){const l=W.rangy;let e,o,n,r,s,i,u,p,m=c.serial||Math.floor(1e16*Math.random()),f,y,h,E;d._name=c.name||"angularjstexteditorEditor"+m;function g(e,t,a){w(function(){e.one(t,a)},100)}if(f=z(c.taDefaultWrap),angular.extend(d,angular.copy(C),{wrapSelection:function(e,t,a){"undo"===e.toLowerCase()?d["$undoTaBindtaTextElement"+m]():"redo"===e.toLowerCase()?d["$redoTaBindtaTextElement"+m]():(f(e,!1,t,d.defaultTagAttributes),a&&d["reApplyOnSelectorHandlerstaTextElement"+m](),d.displayElements.text[0].focus())},showHtml:d.$eval(c.taShowHtml)||!1}),c.taFocussedClass&&(d.classes.focussed=c.taFocussedClass),c.taTextEditorClass&&(d.classes.textEditor=c.taTextEditorClass),c.taHtmlEditorClass&&(d.classes.htmlEditor=c.taHtmlEditorClass),c.taDefaultTagAttributes)try{angular.extend(d.defaultTagAttributes,angular.fromJson(c.taDefaultTagAttributes))}catch(e){_.error(e)}c.taTextEditorSetup&&(d.setup.textEditorSetup=d.$parent.$eval(c.taTextEditorSetup)),c.taHtmlEditorSetup&&(d.setup.htmlEditorSetup=d.$parent.$eval(c.taHtmlEditorSetup)),c.taFileDrop?d.fileDropHandler=d.$parent.$eval(c.taFileDrop):d.fileDropHandler=d.defaultFileDropHandler,u=t[0].innerHTML,t[0].innerHTML="",d.displayElements={forminput:angular.element("<input type='hidden' tabindex='-1' style='display: none;'>"),html:angular.element("<textarea></textarea>"),text:angular.element("<div></div>"),scrollWindow:angular.element("<div class='ta-scroll-window'></div>"),popover:angular.element('<div class="popover fade bottom" style="max-width: none; width: 305px;"></div>'),popoverArrow:angular.element('<div class="arrow"></div>'),popoverContainer:angular.element('<div class="popover-content"></div>'),resize:{overlay:angular.element('<div class="ta-resizer-handle-overlay"></div>'),background:angular.element('<div class="ta-resizer-handle-background"></div>'),anchors:[angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-tl"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-tr"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-bl"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-br"></div>')],info:angular.element('<div class="ta-resizer-handle-info"></div>')}},d.displayElements.popover.append(d.displayElements.popoverArrow),d.displayElements.popover.append(d.displayElements.popoverContainer),d.displayElements.scrollWindow.append(d.displayElements.popover),d.displayElements.popover.on("mousedown",function(e,t){return t&&angular.extend(e,t),e.preventDefault(),!1}),d.handlePopoverEvents=function(){"block"===d.displayElements.popover.css("display")&&(E&&w.cancel(E),E=w(function(){d.reflowPopover(d.resizeElement),d.reflowResizeOverlay(d.resizeElement)},100))},angular.element(window).on("resize",d.handlePopoverEvents),angular.element(window).on("scroll",d.handlePopoverEvents);d.getScrollTop=function(e,t){var a=e.scrollTop;return void 0===a&&(a=0),t&&function(e){var t={vertical:!1,horizontal:!1};try{if(null===(a=window.getComputedStyle(e)))return t}catch(e){return t}var t=a["overflow-y"],a=a["overflow-x"];return{vertical:("scroll"===t||"auto"===t)&&e.scrollHeight>e.clientHeight,horizontal:("scroll"===a||"auto"===a)&&e.scrollWidth>e.clientWidth}}(e).vertical&&(e.removeEventListener("scroll",d._scrollListener,!1),e.addEventListener("scroll",d._scrollListener,!1)),0!==a?{node:e.nodeName,top:a}:e.parentNode?d.getScrollTop(e.parentNode,t):{node:"<none>",top:0}},d.showPopover=function(e){d.getScrollTop(d.displayElements.scrollWindow[0],!0),d.displayElements.popover.css("display","block"),w(function(){d.displayElements.resize.overlay.css("display","block")}),d.resizeElement=e,d.reflowPopover(e),D.addClass(d.displayElements.popover,"in"),g(H.find("body"),"click keyup",function(){d.hidePopover()})},d._scrollListener=function(e,t){d.handlePopoverEvents()},d.reflowPopover=function(e){var t=d.getScrollTop(d.displayElements.scrollWindow[0],!1);e[0].offsetTop-t.top<51?(d.displayElements.popover.css("top",e[0].offsetTop+e[0].offsetHeight+d.displayElements.scrollWindow[0].scrollTop+"px"),d.displayElements.popover.removeClass("top").addClass("bottom")):(d.displayElements.popover.css("top",e[0].offsetTop-54+d.displayElements.scrollWindow[0].scrollTop+"px"),d.displayElements.popover.removeClass("bottom").addClass("top"));var a=d.displayElements.text[0].offsetWidth-d.displayElements.popover[0].offsetWidth,t=e[0].offsetLeft+e[0].offsetWidth/2-d.displayElements.popover[0].offsetWidth/2,e=Math.max(0,Math.min(a,t)),a=Math.min(t,Math.max(0,t-a))-11;e+=window.scrollX,a-=window.scrollX,d.displayElements.popover.css("left",e+"px"),d.displayElements.popoverArrow.css("margin-left",a+"px")},d.hidePopover=function(){d.displayElements.popover.css("display","none"),d.displayElements.popoverContainer.attr("style",""),d.displayElements.popoverContainer.attr("class","popover-content"),d.displayElements.popover.removeClass("in"),d.displayElements.resize.overlay.css("display","none")},d.displayElements.resize.overlay.append(d.displayElements.resize.background),angular.forEach(d.displayElements.resize.anchors,function(e){d.displayElements.resize.overlay.append(e)}),d.displayElements.resize.overlay.append(d.displayElements.resize.info),d.displayElements.scrollWindow.append(d.displayElements.resize.overlay),d.displayElements.resize.background.on("click",function(e){d.displayElements.text[0].focus()}),d.reflowResizeOverlay=function(e){e=angular.element(e)[0],d.displayElements.resize.overlay.css({display:"block",left:e.offsetLeft-5+"px",top:e.offsetTop-5+"px",width:e.offsetWidth+10+"px",height:e.offsetHeight+10+"px"}),d.displayElements.resize.info.text(e.offsetWidth+" x "+e.offsetHeight)},d.showResizeOverlay=function(i){var a=H.find("body");y=function(e){var r={width:parseInt(i.attr("width")),height:parseInt(i.attr("height")),x:e.clientX,y:e.clientY};void 0!==r.width&&!isNaN(r.width)||(r.width=i[0].offsetWidth),void 0!==r.height&&!isNaN(r.height)||(r.height=i[0].offsetHeight),d.hidePopover();function t(e){var t={x:Math.max(0,r.width+(e.clientX-r.x)),y:Math.max(0,r.height+(e.clientY-r.y))},a=void 0!==c.taResizeForceAspectRatio,o=c.taResizeMaintainAspectRatio;(a||o&&!e.shiftKey)&&(l=t.y/t.x,t.x=l<s?t.x:t.y/s,t.y=l<s?t.x*s:t.y);var l=angular.element(i);function n(e){return Math.round(Math.max(0,e))}l.css("height",n(t.y)+"px"),l.css("width",n(t.x)+"px"),d.reflowResizeOverlay(i)}var s=r.height/r.width;a.on("mousemove",t),g(a,"mouseup",function(e){e.preventDefault(),e.stopPropagation(),a.off("mousemove",t),d.$apply(function(){d.hidePopover(),d.updateTaBindtaTextElement()},100)}),e.stopPropagation(),e.preventDefault()},d.displayElements.resize.anchors[3].off("mousedown"),d.displayElements.resize.anchors[3].on("mousedown",y),d.reflowResizeOverlay(i),g(a,"click",function(){d.hideResizeOverlay()})},d.hideResizeOverlay=function(){d.displayElements.resize.anchors[3].off("mousedown",y),d.displayElements.resize.overlay.css("display","none")},d.setup.htmlEditorSetup(d.displayElements.html),d.setup.textEditorSetup(d.displayElements.text),d.displayElements.html.attr({id:"taHtmlElement"+m,"ng-show":"showHtml","ta-bind":"ta-bind","ng-model":"html","ng-model-options":t.attr("ng-model-options")}),d.displayElements.text.attr({id:"taTextElement"+m,contentEditable:"true","ta-bind":"ta-bind","ng-model":"html","ng-model-options":t.attr("ng-model-options")}),d.displayElements.scrollWindow.attr({"ng-hide":"showHtml"}),c.taDefaultWrap&&d.displayElements.text.attr("ta-default-wrap",c.taDefaultWrap),c.taUnsafeSanitizer&&(d.displayElements.text.attr("ta-unsafe-sanitizer",c.taUnsafeSanitizer),d.displayElements.html.attr("ta-unsafe-sanitizer",c.taUnsafeSanitizer)),c.taKeepStyles&&(d.displayElements.text.attr("ta-keep-styles",c.taKeepStyles),d.displayElements.html.attr("ta-keep-styles",c.taKeepStyles)),d.displayElements.scrollWindow.append(d.displayElements.text),t.append(d.displayElements.scrollWindow),t.append(d.displayElements.html),d.displayElements.forminput.attr("name",d._name),t.append(d.displayElements.forminput),c.tabindex&&(t.removeAttr("tabindex"),d.displayElements.text.attr("tabindex",c.tabindex),d.displayElements.html.attr("tabindex",c.tabindex)),c.placeholder&&(d.displayElements.text.attr("placeholder",c.placeholder),d.displayElements.html.attr("placeholder",c.placeholder)),c.taDisabled&&(d.displayElements.text.attr("ta-readonly","disabled"),d.displayElements.html.attr("ta-readonly","disabled"),d.disabled=d.$parent.$eval(c.taDisabled),d.$parent.$watch(c.taDisabled,function(e){d.disabled=e,d.disabled?t.addClass(d.classes.disabled):t.removeClass(d.classes.disabled)})),c.taPaste&&(d._pasteHandler=function(e){return k(c.taPaste)(d.$parent,{$html:e})},d.displayElements.text.attr("ta-paste","_pasteHandler($html)")),T(d.displayElements.scrollWindow)(d),T(d.displayElements.html)(d),d.updateTaBindtaTextElement=d["updateTaBindtaTextElement"+m],d.updateTaBindtaHtmlElement=d["updateTaBindtaHtmlElement"+m],t.addClass("ta-root"),d.displayElements.scrollWindow.addClass("ta-text ta-editor "+d.classes.textEditor),d.displayElements.html.addClass("ta-html ta-editor "+d.classes.htmlEditor);function v(e,t){t!==H[0].queryCommandState(e)&&H[0].execCommand(e,!1,null)}var b,x,S=d._actionRunning=!1;d.startAction=function(){var e,t,a,o;return d._actionRunning=!0,e=H[0].queryCommandState("bold"),t=H[0].queryCommandState("italic"),a=H[0].queryCommandState("underline"),o=H[0].queryCommandState("strikeThrough"),S=l.saveSelection(),v("bold",e),v("italic",t),v("underline",a),v("strikeThrough",o),function(){S&&l.restoreSelection(S)}},d.endAction=function(){d._actionRunning=!1,S&&((d.showHtml?d.displayElements.html:d.displayElements.text)[0].focus(),l.removeMarkers(S)),S=!1,d.updateSelectedStyles(),d.showHtml||d["updateTaBindtaTextElement"+m]()},d.displayElements.html.on("focus",s=function(e){d.focussed=!0,t.addClass(d.classes.focussed),p.focus(),t.triggerHandler("focus"),d.updateSelectedStyles&&!d._bUpdateSelectedStyles&&w(function(){d.updateSelectedStyles()},0)}),d.displayElements.text.on("focus",s),d.displayElements.html.on("blur",i=function(e){return d._actionRunning||H[0].activeElement===d.displayElements.html[0]||H[0].activeElement===d.displayElements.text[0]||(t.removeClass(d.classes.focussed),p.unfocus(),w(function(){d._bUpdateSelectedStyles=!1,t.triggerHandler("blur"),d.focussed=!1},0)),e.preventDefault(),!1}),d.displayElements.text.on("blur",i),d.displayElements.text.on("paste",function(e){t.triggerHandler("paste",e)}),d.queryFormatBlockState=function(e){return!d.showHtml&&e.toLowerCase()===H[0].queryCommandValue("formatBlock").toLowerCase()},d.queryCommandState=function(e){return d.showHtml?"":H[0].queryCommandState(e)},d.switchView=function(){d.showHtml=!d.showHtml,D.enabled(!1,d.displayElements.html),D.enabled(!1,d.displayElements.text),d.showHtml?w(function(){return D.enabled(!0,d.displayElements.html),D.enabled(!0,d.displayElements.text),d.displayElements.html[0].focus()},100):w(function(){return D.enabled(!0,d.displayElements.html),D.enabled(!0,d.displayElements.text),d.displayElements.text[0].focus()},100)},c.ngModel?(b=!0,a.$render=function(){b&&(b=!1,null==d.$parent.$eval(c.ngModel)&&u&&""!==u&&a.$setViewValue(u)),d.displayElements.forminput.val(a.$viewValue),d.html=a.$viewValue||""},t.attr("required")&&(a.$validators.required=function(e,t){t=e||t;return!(!t||""===t.trim())})):(d.displayElements.forminput.val(u),d.html=u),d.$watch("html",function(e,t){e!==t&&(c.ngModel&&a.$viewValue!==e&&a.$setViewValue(e),d.displayElements.forminput.val(e))}),p=c.taTargetToolbars?A.registerEditor(d._name,d,c.taTargetToolbars.split(",")):(x=angular.element('<div class="text-editor-group" angularjstexteditor-toolbar name="angularjstexteditorToolbar'+m+'">'),c.taToolbar&&x.attr("ta-toolbar",c.taToolbar),c.taToolbarClass&&x.attr("ta-toolbar-class",c.taToolbarClass),c.taToolbarGroupClass&&x.attr("ta-toolbar-group-class",c.taToolbarGroupClass),c.taToolbarButtonClass&&x.attr("ta-toolbar-button-class",c.taToolbarButtonClass),c.taToolbarActiveButtonClass&&x.attr("ta-toolbar-active-button-class",c.taToolbarActiveButtonClass),c.taFocussedClass&&x.attr("ta-focussed-class",c.taFocussedClass),t.prepend(x),T(x)(d.$parent),A.registerEditor(d._name,d,["angularjstexteditorToolbar"+m])),d.$on("$destroy",function(){A.unregisterEditor(d._name),angular.element(window).off("blur"),angular.element(window).off("resize",d.handlePopoverEvents),angular.element(window).off("scroll",d.handlePopoverEvents)}),d.$on("ta-element-select",function(e,t){p.triggerElementSelect(e,t)&&d["reApplyOnSelectorHandlerstaTextElement"+m]()}),d.$on("ta-drop-event",function(e,t,a,o){o&&o.files&&0<o.files.length?(d.displayElements.text[0].focus(),$.setSelectionToElementEnd(a.target),angular.forEach(o.files,function(e){try{j.when(d.fileDropHandler(e,d.wrapSelection)||d.fileDropHandler!==d.defaultFileDropHandler&&j.when(d.defaultFileDropHandler(e,d.wrapSelection))).then(function(){d["updateTaBindtaTextElement"+m]()})}catch(e){_.error(e)}}),a.preventDefault(),a.stopPropagation()):w(function(){d["updateTaBindtaTextElement"+m]()},0)}),d._bUpdateSelectedStyles=!1,angular.element(window).on("blur",function(){d._bUpdateSelectedStyles=!1,d.focussed=!1}),d.updateSelectedStyles=function(){var e;h&&w.cancel(h),void 0!==(e=$.getSelectionElement())&&e.parentNode!==d.displayElements.text[0]?p.updateSelectedStyles(angular.element(e)):p.updateSelectedStyles(),d._bUpdateSelectedStyles&&(h=w(d.updateSelectedStyles,200))},d.displayElements.html.on("keydown",e=function(){d.focussed?d._bUpdateSelectedStyles||(d._bUpdateSelectedStyles=!0,d.$apply(function(){d.updateSelectedStyles()})):d._bUpdateSelectedStyles=!1}),d.displayElements.text.on("keydown",e),d.displayElements.html.on("keyup",o=function(){d._bUpdateSelectedStyles=!1}),d.displayElements.text.on("keyup",o),d.displayElements.html.on("keypress",n=function(e,t){var a;$.getSelection&&(a=$.getSelection(),$.getSelectionElement()&&"a"===$.getSelectionElement().nodeName.toLowerCase()&&(3===a.start.element.nodeType&&a.start.element.textContent.length===a.end.offset&&$.setSelectionAfterElement($.getSelectionElement()),3===a.start.element.nodeType&&0===a.start.offset&&$.setSelectionBeforeElement($.getSelectionElement()))),t&&angular.extend(e,t),d.$apply(function(){if(p.sendKeyCommand(e))return d._bUpdateSelectedStyles||d.updateSelectedStyles(),e.preventDefault(),!1})}),d.displayElements.text.on("keypress",n),d.displayElements.html.on("mouseup",r=function(){d._bUpdateSelectedStyles=!1,w(function(){d.updateSelectedStyles()},0)}),d.displayElements.text.on("mouseup",r)}}}]),angularjstexteditor.service("angularjstexteditorManager",["taToolExecuteAction","taTools","taRegisterTool","$interval","$rootScope","$log",function(n,m,r,e,t,a){var o,s={},f={},l=0,i=function(t){angular.forEach(f,function(e){e.editorFunctions.updateSelectedStyles(t)})},d=50;t.$on("destroy",function(){o&&(e.cancel(o),o=void 0)});function c(){Math.abs(Date.now()-l)>d&&(l=Date.now(),o=e(function(){i(),o=void 0},d,1))}return{registerEditor:function(u,p,e){if(!u||""===u)throw"angularjstexteditor Error: An editor requires a name";if(!p)throw"angularjstexteditor Error: An editor requires a scope";if(f[u])throw'angularjstexteditor Error: An Editor with name "'+u+'" already exists';return f[u]={scope:p,toolbars:e,toolbarScopes:[],_registerToolbarScope:function(e){0<=this.toolbars.indexOf(e.name)&&this.toolbarScopes.push(e)},editorFunctions:{disable:function(){angular.forEach(f[u].toolbarScopes,function(e){e.disabled=!0})},enable:function(){angular.forEach(f[u].toolbarScopes,function(e){e.disabled=!1})},focus:function(){angular.forEach(f[u].toolbarScopes,function(e){e._parent=p,e.disabled=!1,e.focussed=!0}),p.focussed=!0},unfocus:function(){angular.forEach(f[u].toolbarScopes,function(e){e.disabled=!0,e.focussed=!1}),p.focussed=!1},updateSelectedStyles:function(a){angular.forEach(f[u].toolbarScopes,function(t){angular.forEach(t.tools,function(e){e.activeState&&(t._parent=p,e.active=e.activeState(a))})})},sendKeyCommand:function(o){var l=!1;return(o.ctrlKey||o.metaKey||o.specialKey)&&angular.forEach(m,function(e,t){if(e.commandKeyCode&&(e.commandKeyCode===o.which||e.commandKeyCode===o.specialKey))for(var a=0;a<f[u].toolbarScopes.length;a++)if(void 0!==f[u].toolbarScopes[a].tools[t]){n.call(f[u].toolbarScopes[a].tools[t],p),l=!0;break}}),l},triggerElementSelect:function(e,a){function o(e,t){for(var a=!0,o=0;o<t.length;o++)a=a&&e.attr(t[o]);return a}var l=[],n={},t=!1;a=angular.element(a);var r=!1;if(angular.forEach(m,function(e,t){e.onElementSelect&&e.onElementSelect.element&&e.onElementSelect.element.toLowerCase()===a[0].tagName.toLowerCase()&&(!e.onElementSelect.filter||e.onElementSelect.filter(a))&&(r=r||angular.isArray(e.onElementSelect.onlyWithAttrs)&&o(a,e.onElementSelect.onlyWithAttrs),e.onElementSelect.onlyWithAttrs&&!o(a,e.onElementSelect.onlyWithAttrs)||(n[t]=e))}),r?(angular.forEach(n,function(e,t){e.onElementSelect.onlyWithAttrs&&o(a,e.onElementSelect.onlyWithAttrs)&&l.push({name:t,tool:e})}),l.sort(function(e,t){return t.tool.onElementSelect.onlyWithAttrs.length-e.tool.onElementSelect.onlyWithAttrs.length})):angular.forEach(n,function(e,t){l.push({name:t,tool:e})}),0<l.length)for(var s=0;s<l.length;s++){for(var i=l[s].tool,d=l[s].name,c=0;c<f[u].toolbarScopes.length;c++)if(void 0!==f[u].toolbarScopes[c].tools[d]){i.onElementSelect.action.call(f[u].toolbarScopes[c].tools[d],e,a,p),t=!0;break}if(t)break}return t}}},angular.forEach(e,function(e){s[e]&&f[u].toolbarScopes.push(s[e])}),c(),f[u].editorFunctions},retrieveEditor:function(e){return f[e]},unregisterEditor:function(e){delete f[e],c()},registerToolbar:function(t){if(!t)throw"angularjstexteditor Error: A toolbar requires a scope";if(!t.name||""===t.name)throw"angularjstexteditor Error: A toolbar requires a name";if(s[t.name])throw'angularjstexteditor Error: A toolbar with name "'+t.name+'" already exists';s[t.name]=t,angular.forEach(f,function(e){e._registerToolbarScope(t)}),c()},retrieveToolbar:function(e){return s[e]},retrieveToolbarsViaEditor:function(e){var t=[],a=this;return angular.forEach(this.retrieveEditor(e).toolbars,function(e){t.push(a.retrieveToolbar(e))}),t},unregisterToolbar:function(e){delete s[e],c()},updateToolsDisplay:function(e){var a=this;angular.forEach(e,function(e,t){a.updateToolDisplay(t,e)})},resetToolsDisplay:function(){var a=this;angular.forEach(m,function(e,t){a.resetToolDisplay(t)}),c()},updateToolDisplay:function(a,o){var l=this;angular.forEach(s,function(e,t){l.updateToolbarToolDisplay(t,a,o)}),c()},resetToolDisplay:function(a){var o=this;angular.forEach(s,function(e,t){o.resetToolbarToolDisplay(t,a)}),c()},updateToolbarToolDisplay:function(e,t,a){if(!s[e])throw'angularjstexteditor Error: No Toolbar with name "'+e+'" exists';s[e].updateToolDisplay(t,a)},resetToolbarToolDisplay:function(e,t){if(!s[e])throw'angularjstexteditor Error: No Toolbar with name "'+e+'" exists';s[e].updateToolDisplay(t,m[t],!0)},removeTool:function(l){delete m[l],angular.forEach(s,function(e){delete e.tools[l];for(var t=0;t<e.toolbar.length;t++){for(var a,o=0;o<e.toolbar[t].length;o++){if(e.toolbar[t][o]===l){a={group:t,index:o};break}if(void 0!==a)break}void 0!==a&&(e.toolbar[a.group].slice(a.index,1),e._$element.children().eq(a.group).children().eq(a.index).remove())}}),c()},addTool:function(t,a,o,l){r(t,a),angular.forEach(s,function(e){e.addTool(t,a,o,l)}),c()},addToolToToolbar:function(e,t,a,o,l){r(e,t),s[a].addTool(e,t,o,l),c()},refreshEditor:function(e){if(!f[e])throw'angularjstexteditor Error: No Editor with name "'+e+'" exists';f[e].scope.updateTaBindtaTextElement(),f[e].scope.$$phase||f[e].scope.$digest(),c()},sendKeyCommand:function(e,t){var a=f[e._name];if(a&&a.editorFunctions.sendKeyCommand(t))return e._bUpdateSelectedStyles||e.updateSelectedStyles(),t.preventDefault(),!1},updateStyles:i,getVersion:function(){return angularjstexteditorVersion},getToolbarScopes:function(){var t=[];return angular.forEach(f,function(e){t=t.concat(e.toolbarScopes)}),t}}}]),angularjstexteditor.directive("angularjstexteditorToolbar",["$compile","angularjstexteditorManager","taOptions","taTools","taToolExecuteAction","$window",function(d,t,a,c,o,l){return{scope:{name:"@"},restrict:"EA",link:function(n,r,e){if(!n.name||""===n.name)throw"angularjstexteditor Error: A toolbar requires a name";angular.extend(n,angular.copy(a)),e.taToolbar&&(n.toolbar=n.$parent.$eval(e.taToolbar)),e.taToolbarClass&&(n.classes.toolbar=e.taToolbarClass),e.taToolbarGroupClass&&(n.classes.toolbarGroup=e.taToolbarGroupClass),e.taToolbarButtonClass&&(n.classes.toolbarButton=e.taToolbarButtonClass),e.taToolbarActiveButtonClass&&(n.classes.toolbarButtonActive=e.taToolbarActiveButtonClass),e.taFocussedClass&&(n.classes.focussed=e.taFocussedClass),n.disabled=!0,n.focussed=!1,(n._$element=r)[0].innerHTML="",r.addClass("ta-toolbar "+n.classes.toolbar),n.$watch("focussed",function(){n.focussed?r.addClass(n.classes.focussed):r.removeClass(n.classes.focussed)});function s(e,t){var a,o,l=e&&e.display?angular.element(e.display):angular.element("<button type='button'>");return e&&e.class?l.addClass(e.class):l.addClass(n.classes.toolbarButton),l.attr("name",t.name),l.attr("ta-button","ta-button"),l.attr("ng-disabled","isDisabled()"),l.attr("tabindex","-1"),l.attr("ng-click","executeAction()"),l.attr("ng-class","displayActiveToolClass(active)"),e&&e.tooltiptext&&l.attr("title",e.tooltiptext),!e||e.display||t._display||(l[0].innerHTML="",e.buttontext&&(l[0].innerHTML=e.buttontext),e.iconclass&&(a=angular.element("<i>"),o=l[0].innerHTML,a.addClass(e.iconclass),l[0].innerHTML="",l.append(a),o&&""!==o&&l.append("&nbsp;"+o))),t._lastToolDefinition=angular.copy(e),d(l)(t)}n.tools={},n._parent={disabled:!0,showHtml:!1,queryFormatBlockState:function(){return!1},queryCommandState:function(){return!1}};var i={$window:l,$editor:function(){return n._parent},isDisabled:function(){return("html"!==this.name||!n._parent.startAction)&&("function"!=typeof this.$eval("disabled")&&this.$eval("disabled")||this.$eval("disabled()")||"html"!==this.name&&this.$editor().showHtml||this.$parent.disabled||this.$editor().disabled)},displayActiveToolClass:function(e){return e?n.classes.toolbarButtonActive:""},executeAction:o};angular.forEach(n.toolbar,function(e){var t=angular.element("<div>");t.addClass(n.classes.toolbarGroup),angular.forEach(e,function(e){n.tools[e]=angular.extend(n.$new(!0),c[e],i,{name:e}),n.tools[e].$element=s(c[e],n.tools[e]),t.append(n.tools[e].$element)}),r.append(t)}),n.updateToolDisplay=function(e,t,a){var o=n.tools[e];if(o){if(null===(t=o._lastToolDefinition&&!a?angular.extend({},o._lastToolDefinition,t):t).buttontext&&null===t.iconclass&&null===t.display)throw'angularjstexteditor Error: Tool Definition for updating "'+e+'" does not have a valid display/iconclass/buttontext value';null===t.buttontext&&delete t.buttontext,null===t.iconclass&&delete t.iconclass,null===t.display&&delete t.display;t=s(t,o);o.$element.replaceWith(t),o.$element=t}},n.addTool=function(e,t,a,o){var l;n.tools[e]=angular.extend(n.$new(!0),c[e],i,{name:e}),n.tools[e].$element=s(c[e],n.tools[e]),void 0===a&&(a=n.toolbar.length-1),l=angular.element(r.children()[a]),void 0===o?(l.append(n.tools[e].$element),n.toolbar[a][n.toolbar[a].length-1]=e):(l.children().eq(o).after(n.tools[e].$element),n.toolbar[a][o]=e)},t.registerToolbar(n),n.$on("$destroy",function(){t.unregisterToolbar(n.name)})}}}]),angularjstexteditor.directive("angularjstexteditorVersion",["angularjstexteditorManager",function(e){var o=e.getVersion();return{restrict:"EA",link:function(e,t,a){t.html(o)}}}]);